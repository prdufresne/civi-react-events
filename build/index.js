(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var i in a)e.o(a,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:a[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,a=window.React;var i=e.n(a);function n(e){const{startDate:a,endDate:i}=e;let n=a.weekday,l=a.day,s="";return i&&a.date!=i.date&&(n=`${a.weekday.substring(0,3)}-${i.weekday.substring(0,3)}`,l+=`-${parseInt(i.day)}`,s=" multiday"),(0,t.createElement)("div",{class:"civi-react-events-cell-date"},(0,t.createElement)("div",{class:"civi-react-events-weekday"},n),(0,t.createElement)("div",{class:"civi-react-events-day"+s},l))}function l(e){return(0,t.createElement)("div",{className:"civi-react-events-modal",onClick:e.closeModal},(0,t.createElement)("div",{className:"civi-react-events-modal-content"},(0,t.createElement)("h3",null,"Event Participants"),(0,t.createElement)("table",null,(0,t.createElement)("thead",null,(0,t.createElement)("tr",null,(0,t.createElement)("th",null,"Name"),(0,t.createElement)("th",null,"Attendee Role"))),(0,t.createElement)("tbody",null,e.participants.map(((e,a)=>(0,t.createElement)("tr",null,(0,t.createElement)("td",null,e.name),(0,t.createElement)("td",null,e["role_id:label"].join(", ")))))))))}class s extends i().Component{constructor(e){super(e),this.state={title:"Civi React Calendar",events:[],event_types:[],showFilter:!1,filters:{},participantsList:void 0},this.changeHandler=this.changeHandler.bind(this),this.closeParticipantsModal=this.closeParticipantsModal.bind(this)}componentDidMount(){this.loadData()}loadData(){this.fetchEvents().then((e=>{const{events:t,event_types:a,user_status:i}=e,n={applied:{event_type:!1,registration:!1,event_full:!1},event_type:{},registration:{registered:!1,not_registered:!1},event_full:{available:!1,full:!1}};a.forEach((e=>{n.event_type[e.value]=!1})),console.log("user_status:",i),this.setState({events:t,event_types:a,filters:n,is_member:i.is_member,is_trail_leader:i.is_trail_leader})}))}fetchEvents=()=>new Promise(((e,t)=>{jQuery.post(my_ajax_object.ajax_url,{action:"civi_react_events",request:"event-list",data:"This is data passed to the backed"},(function(t){return e(JSON.parse(t))})).fail((function(e){return t(e)}))}));showEventParticipants=(e,t)=>{e.stopPropagation(),this.fetchParticipants(t).then((e=>{console.log(`Participants for ${t} are:`,e),this.setState({participantsList:e})}))};fetchParticipants=e=>new Promise(((t,a)=>{const i={action:"civi_react_events",request:"participant-list",data:e};jQuery.post(my_ajax_object.ajax_url,i,(function(e){return t(JSON.parse(e))})).fail((function(e){return a(e)}))}));changeHandler(e){const{name:t,id:a,checked:i}=e.target,{filters:n}=this.state;n[t][a.toString()]=i,n.applied[t]=this.anyChecked(n[t]),this.setState({filters:n})}closeParticipantsModal(){this.setState({participantsList:void 0})}anyChecked(e){let t=!1;return e&&Object.keys(e).forEach((a=>{t=t||e[a]})),t}render(){const{event_types:e,events:a,showFilter:i,filters:s}=this.state;let r="";return console.log("participants list:",this.state.participantsList),(0,t.createElement)("div",{className:"civi-react-events"},this.state.participantsList?(0,t.createElement)(l,{closeModal:this.closeParticipantsModal,participants:this.state.participantsList}):"",(0,t.createElement)("div",{className:"civi-react-events-filter-block"},(0,t.createElement)("div",{className:"civi-react-events-button right",onClick:()=>this.setState({showFilter:!i})},i?"Hide Filters":"Show Filters"),(0,t.createElement)("div",{className:"civi-react-events-filters "+(i?"":"hide")},(0,t.createElement)("div",{className:"civi-react-events-filters-types"},e.map(((e,a)=>(0,t.createElement)(t.Fragment,null,(0,t.createElement)("input",{type:"checkbox",name:"event_type",id:e.value,onChange:this.changeHandler,checked:this.filters?.event_type[e.value]}),(0,t.createElement)("label",null,e.label),(0,t.createElement)("br",null))))),(0,t.createElement)("div",{className:"civi-react-events-filters-status"},(0,t.createElement)("input",{type:"checkbox",name:"registration",id:"registered",onChange:this.changeHandler}),(0,t.createElement)("label",null,"Registered"),(0,t.createElement)("br",null),(0,t.createElement)("input",{type:"checkbox",name:"registration",id:"not_registered",onChange:this.changeHandler}),(0,t.createElement)("label",null,"Not Registered"),(0,t.createElement)("br",null),(0,t.createElement)("input",{type:"checkbox",name:"event_full",id:"available",onChange:this.changeHandler}),(0,t.createElement)("label",null,"Available Events"),(0,t.createElement)("br",null),(0,t.createElement)("input",{type:"checkbox",name:"event_full",id:"full",onChange:this.changeHandler}),(0,t.createElement)("label",null,"Full Events"),(0,t.createElement)("br",null)))),a.map(((e,a)=>{if((!s.applied.event_type||s.event_type[e.event_type_id.toString()])&&(!s.applied.registration||s.registration[e.is_registered?"registered":"not_registered"])&&(!s.applied.event_full||s.event_full[e.is_full?"full":"available"])){const{start_date:i,end_date:l}=e;let s=!1;return i.month!=r&&(r=i.month,s=!0),(0,t.createElement)(t.Fragment,null,s&&(0,t.createElement)("h3",null,r),(0,t.createElement)("div",{index:a,type:e["event_type_id:label"],className:"civi-react-events-event",onClick:()=>this.props.history.push(e.event_url)},(0,t.createElement)(n,{startDate:i,endDate:l}),(0,t.createElement)("div",{className:"civi-react-events-content-column"},(0,t.createElement)("div",{className:"civi-react-events-actions"},e.is_online_registration&&!e.is_full&&!e.is_registered&&(0,t.createElement)("a",{href:e.registration_url},(0,t.createElement)("div",{className:"civi-react-events-button"},"Register")),e.is_online_registration&&this.state.is_trail_leader&&(0,t.createElement)("img",{src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tISBGb250IEF3ZXNvbWUgRnJlZSA2LjMuMCBieSBAZm9udGF3ZXNvbWUgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbSBMaWNlbnNlIC0gaHR0cHM6Ly9mb250YXdlc29tZS5jb20vbGljZW5zZS9mcmVlIChJY29uczogQ0MgQlkgNC4wLCBGb250czogU0lMIE9GTCAxLjEsIENvZGU6IE1JVCBMaWNlbnNlKSBDb3B5cmlnaHQgMjAyMyBGb250aWNvbnMsIEluYy4gLS0+PHBhdGggZD0iTTcyIDg4YTU2IDU2IDAgMSAxIDExMiAwQTU2IDU2IDAgMSAxIDcyIDg4ek02NCAyNDUuN0M1NCAyNTYuOSA0OCAyNzEuOCA0OCAyODhzNiAzMS4xIDE2IDQyLjNWMjQ1Ljd6bTE0NC40LTQ5LjNDMTc4LjcgMjIyLjcgMTYwIDI2MS4yIDE2MCAzMDRjMCAzNC4zIDEyIDY1LjggMzIgOTAuNVY0MTZjMCAxNy43LTE0LjMgMzItMzIgMzJIOTZjLTE3LjcgMC0zMi0xNC4zLTMyLTMyVjM4OS4yQzI2LjIgMzcxLjIgMCAzMzIuNyAwIDI4OGMwLTYxLjkgNTAuMS0xMTIgMTEyLTExMmgzMmMyNCAwIDQ2LjIgNy41IDY0LjQgMjAuM3pNNDQ4IDQxNlYzOTQuNWMyMC0yNC43IDMyLTU2LjIgMzItOTAuNWMwLTQyLjgtMTguNy04MS4zLTQ4LjQtMTA3LjdDNDQ5LjggMTgzLjUgNDcyIDE3NiA0OTYgMTc2aDMyYzYxLjkgMCAxMTIgNTAuMSAxMTIgMTEyYzAgNDQuNy0yNi4yIDgzLjItNjQgMTAxLjJWNDE2YzAgMTcuNy0xNC4zIDMyLTMyIDMySDQ4MGMtMTcuNyAwLTMyLTE0LjMtMzItMzJ6bTgtMzI4YTU2IDU2IDAgMSAxIDExMiAwQTU2IDU2IDAgMSAxIDQ1NiA4OHpNNTc2IDI0NS43djg0LjdjMTAtMTEuMyAxNi0yNi4xIDE2LTQyLjNzLTYtMzEuMS0xNi00Mi4zek0zMjAgMzJhNjQgNjQgMCAxIDEgMCAxMjggNjQgNjQgMCAxIDEgMC0xMjh6TTI0MCAzMDRjMCAxNi4yIDYgMzEgMTYgNDIuM1YyNjEuN2MtMTAgMTEuMy0xNiAyNi4xLTE2IDQyLjN6bTE0NC00Mi4zdjg0LjdjMTAtMTEuMyAxNi0yNi4xIDE2LTQyLjNzLTYtMzEuMS0xNi00Mi4zek00NDggMzA0YzAgNDQuNy0yNi4yIDgzLjItNjQgMTAxLjJWNDQ4YzAgMTcuNy0xNC4zIDMyLTMyIDMySDI4OGMtMTcuNyAwLTMyLTE0LjMtMzItMzJWNDA1LjJjLTM3LjgtMTgtNjQtNTYuNS02NC0xMDEuMmMwLTYxLjkgNTAuMS0xMTIgMTEyLTExMmgzMmM2MS45IDAgMTEyIDUwLjEgMTEyIDExMnoiLz48L3N2Zz4=",onClick:t=>this.showEventParticipants(t,e.id)})),(0,t.createElement)("div",{className:"civi-react-events-title"},e.title,e.is_online_registration&&(e.is_full?(0,t.createElement)("div",{className:"civi-react-events-pill full"},"Full"):(0,t.createElement)("div",{className:"civi-react-events-pill"},`${e.participants}/${e.max_participants}`)),e.is_registered&&(0,t.createElement)("div",{className:"civi-react-events-pill registered"},"Registered")),(0,t.createElement)("div",{className:"civi-react-events-description"},e.summary))))}})))}}const r=s,c=document.getElementById("civi-react-events");c&&(0,t.render)((0,t.createElement)(r,null),c)})();